name: default
on: [push]
jobs:
  php-cs-fixer:
      name: Validate code style
      runs-on: ubuntu-latest
      steps:
          - name: Checkout
            uses: actions/checkout@v1
          - name: Install Task
            uses: Arduino/actions/setup-taskfile@master
          - name: check codestyle
            run: task check-code-style

  composer-validate:
    name: Validate composer configuration
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Install Task
        uses: Arduino/actions/setup-taskfile@master
      - name: composer validate
        run: task check-composer

  php-magic-number-detector:
      name: Validate no magic numbers
      runs-on: ubuntu-latest
      steps:
          - name: Checkout
            uses: actions/checkout@v1
          - name: Install Task
            uses: Arduino/actions/setup-taskfile@master
          - name: run phpmnd
            run: task check-magic-numbers

  test:
      name: Analyze code application and test
      run-on: ubuntu-latest
      env:
        IMAGE_NAME: densul/slave-market:latest
      steps:
        - name: Checkout
          uses: actions/checkout@v1
        - name: Build
          run: docker build -t "${IMAGE_NAME}" -f docker/app/Dockerfile_ci .
        - name: PHPStan
          run : task phpstan
